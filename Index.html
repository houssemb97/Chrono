<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ChronoClasse ‚Äî Jeu de tri chronologique</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { text-align: center; }
#options { margin-bottom: 15px; }
button { margin: 5px; padding: 8px 12px; cursor: pointer; }
input[type="text"] { padding: 8px; width: 250px; }
#propositions button { margin: 4px; }
.ok { color: green; font-weight: bold; }
.ko { color: red; font-weight: bold; }
.notice { margin: 10px 0; font-style: italic; }
</style>
</head>
<body>

<h1>ChronoClasse</h1>

<div id="options">
  Cat√©gorie :
  <select id="categorie"></select>
  <button id="nouvelle">Nouvelle partie</button>
</div>

<div id="propositions"></div>

<div>
  <input type="text" id="saisie" placeholder="Tape un mot...">
  <button id="valider">Valider</button>
  <button id="annuler">Annuler dernier</button>
  <button id="reset">R√©initialiser</button>
  <button id="share">Partager</button>
</div>

<div id="ordreChoisi" class="notice"></div>
<div id="resultat"></div>

<script>
// --- Donn√©es de base ---
const CATEGORIES = {
  "Objets": [
    {label: "T√©l√©phone portable", year: 1973},
    {label: "Ampoule √©lectrique", year: 1879},
    {label: "Ordinateur personnel", year: 1975},
    {label: "Impression 3D", year: 1984},
    {label: "R√©frig√©rateur", year: 1913}
  ],
  "Musique": [
    {label: "Thriller - Michael Jackson", year: 1982},
    {label: "Like a Virgin - Madonna", year: 1984},
    {label: "Smells Like Teen Spirit - Nirvana", year: 1991},
    {label: "Hey Jude - The Beatles", year: 1968},
    {label: "Rolling in the Deep - Adele", year: 2010}
  ]
};

let currentCat = null;
let propositions = [];
let expectedOrder = [];
let entered = [];

// --- S√©lecteurs rapides ---
const $ = sel => document.querySelector(sel);
const elCat = $("#categorie");
const elProps = $("#propositions");
const elSaisie = $("#saisie");
const elResult = $("#resultat");
const elOrder = $("#ordreChoisi");
const elNotice = msg => { if(msg) { elOrder.textContent = msg; } };

// --- Initialisation cat√©gories ---
for (let cat in CATEGORIES) {
  const opt = document.createElement("option");
  opt.value = cat;
  opt.textContent = cat;
  elCat.appendChild(opt);
}

// --- Nouvelle partie ---
function nouvellePartie() {
  currentCat = elCat.value;
  propositions = [...CATEGORIES[currentCat]];
  // M√©lange
  propositions.sort(() => Math.random() - 0.5);
  expectedOrder = [...propositions].sort((a,b) => a.year - b.year).map(e => e.label);
  entered = [];
  afficherPropositions();
  afficherOrdre();
  elResult.innerHTML = "";
}
$("#nouvelle").addEventListener("click", nouvellePartie);

// --- Affichage propositions ---
function afficherPropositions() {
  elProps.innerHTML = "";
  propositions.forEach(p => {
    const btn = document.createElement("button");
    btn.textContent = p.label;
    btn.addEventListener("click", () => validerMot(p.label));
    elProps.appendChild(btn);
  });
}

// --- Affichage ordre choisi ---
function afficherOrdre() {
  elOrder.textContent = "Ton ordre : " + (entered.length ? entered.join(" ‚Üí ") : "(vide)");
}

// --- Validation mot ---
function validerMot(mot) {
  if (entered.includes(mot)) {
    setNotice("Mot d√©j√† choisi", false);
    return;
  }
  const attendu = expectedOrder[entered.length];
  if (mot === attendu) {
    entered.push(mot);
    afficherOrdre();
    setNotice("‚úÖ Correct", true);
    if (entered.length === expectedOrder.length) {
      terminer();
    }
  } else {
    setNotice("‚ùå Faux, essaie encore", false);
  }
  elSaisie.value = ""; // Effacer apr√®s chaque tentative
  elSaisie.focus();
}

// --- Terminer ---
function terminer() {
  elResult.innerHTML = `<span class="ok">Partie termin√©e !</span><br>
    Ordre correct : ${expectedOrder.join(" ‚Üí ")}`;
}

// --- Annuler dernier ---
$("#annuler").addEventListener("click", () => {
  entered.pop();
  afficherOrdre();
});

// --- R√©initialiser ---
$("#reset").addEventListener("click", () => {
  entered = [];
  afficherOrdre();
  elResult.innerHTML = "";
});

// --- Saisie et validation ---
$("#valider").addEventListener("click", () => {
  const mot = elSaisie.value.trim();
  if (!mot) return;
  validerMot(mot);
});
elSaisie.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    const mot = elSaisie.value.trim();
    if (!mot) return;
    validerMot(mot);
  }
});

// --- Partage ---
function buildShareText(){
  const cat = currentCat || elCat.value;
  const progress = `${entered.length}/${expectedOrder.length}`;
  const status = (entered.length === expectedOrder.length) ? "‚úÖ Termin√©" : "üïë En cours";
  const correct = expectedOrder.join(' ‚Üí ');
  const yours = entered.length ? entered.join(' ‚Üí ') : "(vide)";
  const url = location.href;

  return [
    `ChronoClasse ‚Äî ${cat}`,
    `${status} ‚Äî ${progress}`,
    `Ton ordre : ${yours}`,
    (entered.length === expectedOrder.length ? `Ordre correct : ${correct}` : null),
    url
  ].filter(Boolean).join('\n');
}

async function shareScore(){
  const text = buildShareText();
  try {
    if (navigator.share) {
      await navigator.share({ text });
    } else {
      await navigator.clipboard.writeText(text);
      setNotice("Score copi√© dans le presse-papiers ‚úÖ", true);
    }
  } catch(e) {
    try {
      await navigator.clipboard.writeText(text);
      setNotice("Score copi√© dans le presse-papiers ‚úÖ", true);
    } catch {
      alert(text);
    }
  }
}

$("#share").addEventListener("click", shareScore);

// --- Notice ---
function setNotice(msg, good=true){
  elOrder.innerHTML = msg ? `<span class="${good?'ok':'ko'}">${msg}</span><br>` + elOrder.textContent : elOrder.textContent;
}

// --- Lancer la premi√®re partie ---
nouvellePartie();
</script>
</body>
</html>
